# Профилирование (Chrome / React)

Цель — мерить перфоманс **в одинаковых сценариях** и сравнивать “до/после” без шума dev‑окружения.

## Режимы запуска

### Dev (для быстрой итерации)

```bash
npm run dev
```

Плюсы: быстро. Минусы: dev runtime (`jsxDEV`) и HMR добавляют шум.

### Production preview (для честных замеров)

```bash
npm run build
npm run preview -- --host 127.0.0.1
```

Важно: в некоторых окружениях `localhost` может резолвиться в IPv6 `::1`, а preview может быть поднят на IPv4.  
Если видишь проблему с `localhost` — открывай `http://127.0.0.1:<port>/`.

## Chrome Performance (CPU/GPU/Frames)

### Как снимать

1) Открой **Incognito** (без расширений).
2) Открой DevTools → вкладка **Performance**.
3) Нажми Record.
4) Выполни сценарий (см. ниже).
5) Stop → сохрани trace.

### Базовые сценарии (фиксируем одинаково)

- **Load (cold)**: hard reload с очищенным кешем.
- **Load (warm)**: hard reload без очистки кеша.
- **Gameplay**:
  - 2–3 раза **PLAY**
  - дождаться каскада (если есть)
  - включить **AUTO 25** (посмотреть стабильность)
- **Stress**: включить Turbo + Auto (если нужно проверить worst case).

### На что смотреть

- **Main thread long tasks**: пики, которые рвут FPS.
- **Recalculate Style / Layout**: частые/дорогие перерасчёты (особенно во время каскада).
- **Paint / Composite**: тяжёлые эффекты, оверлеи, blur/filter.
- **FPS / Frames**: дропы ниже 60 (на мобилках чаще 30/60).

## React DevTools Profiler (рендеры)

### Как снимать

1) Открой React DevTools → **Profiler**
2) Record profiling
3) Выполни тот же сценарий (например: PLAY → каскад → AUTO)
4) Stop → Export (json)

### Как интерпретировать

- **Commits**: сколько было коммитов рендера за период.
- **Actual duration / Self duration**:
  - Actual: время поддерева
  - Self: вклад конкретного компонента
- Ищем:
  - компоненты, которые ререндерятся “без причины”
  - большие поддеревья, которые можно изолировать (`React.memo`, стабильные props)

### Практические правила

- Если компонент “часто ререндерится” — проверь, не прилетают ли ему новые функции/объекты на каждый рендер.
- Тяжёлые панели (DevTools/log) держать **отдельно** и не рендерить контент, когда закрыты.

## iPhone / Safari (реальный девайс)

Для нагрева/троттлинга важнее **реальный девайс**, чем симуляция.

Рекомендации:

- Сравнивать “без зарядки” и “на зарядке” (нагрев отличается).
- Тестировать каскады и AUTO 25.
- Фиксировать субъективно: “плавность”, “нагрев”, “battery drop”.


