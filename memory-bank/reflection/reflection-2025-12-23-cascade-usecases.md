# Reflection — 2025-12-23 — Cascade usecases (apply step vs build sequence)

## Контекст задачи
Нужно было понять и объяснить различие между `src/application/game/usecases/applyCascadeStep.ts` и `src/application/game/usecases/buildCascadeSequence.ts`: какой файл для чего, в каких сценариях использовать.

## План vs факт
- **План**:
  - Сравнить входы/выходы usecase-ов и правила остановки каскада.
  - Сформулировать назначение: пошаговый UI vs полный прогон/симуляция.
- **Факт**:
  - Сопоставлены контракты и логика остановки.
  - Зафиксированы ключевые отличия: cascade multiplier и jackpot есть только в `applyCascadeStep`, а агрегирование `steps/totalWin` и цикл — в `buildCascadeSequence`.
  - Даны рекомендации по использованию под UI/анимации и под расчёты “одним вызовом”.

## Что сделали
- Объяснили:
  - `applyCascadeStepUseCase` — один шаг каскада, с `winStepNumber`, `cascadeMultiplier`, `didJackpot/jackpotAmount`, детальным “до/после”.
  - `buildCascadeSequenceUseCase` — построение всей последовательности шагов в цикле, возврат `steps`, `totalWin`, финальных состояний; без cascade-множителей и без jackpot.
- Обновили Memory Bank:
  - `memory-bank/tasks.md` — текущая задача, план, чеклист, уровень сложности.
  - `memory-bank/activeContext.md` — текущий фокус и детали.

## Что было сложным / почему
- Сложность низкая: оба файла достаточно “самодокументируемые”, но легко перепутать назначение из-за частично пересекающейся логики (draw/замена winningIndices/остановка при нехватке deck).

## Удачные решения
- Разделение ответственности:
  - Пошаговый usecase (`applyCascadeStep`) хорошо подходит под UI/тайминги.
  - Batch usecase (`buildCascadeSequence`) удобен для симуляций/тестов/быстрых вычислений.

## Что можно улучшить
- (Опционально) Уточнить комментарии/названия полей, чтобы “totalWin без каскад-множителей” не путался с “winAmount со множителем каскада”.
- (Опционально) Добавить краткую ссылку из UI-контроллера/доков на выбранный usecase (где именно используется пошаговый).


