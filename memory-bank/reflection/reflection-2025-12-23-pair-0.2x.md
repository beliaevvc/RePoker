# Reflection — 2025-12-23 — Pair payout 0.3x → 0.2x

## Контекст и цель
Нужно было изменить выплату за комбинацию **Pair** с **0.3x** ставки на **0.2x**.

## План vs факт
- **План**:
  - Найти источник истины для таблицы выплат.
  - Поменять коэффициент Pair: 0.3 → 0.2.
  - Прогнать гейты (test/lint/build) и проверить в UI.
- **Факт**:
  - Источник истины найден: `src/domain/hand-evaluator/constants.ts` (`HAND_MULTIPLIERS`).
  - Pair изменён на 0.2.
  - Обновлены тесты, завязанные на 0.3x.
  - Гейты прогнаны: `npm test`, `npm run lint`, `npm run build` — ✅.

## Что сделали (изменения)
- Обновили `HAND_MULTIPLIERS.Pair`: **0.3 → 0.2**.
- Обновили unit‑тесты, которые явно проверяли множитель/математику:
  - domain: `getBestHand.test.ts`
  - application: `usecases.test.ts` (ожидания по balance/totalWin/baseWinAmount/winAmount)

## Что было сложным / почему
- **Vitest в sandbox падал с `EPERM kill`** (tinypool). Это уже встречалось в проекте, поэтому гейты пришлось прогонять **вне sandbox**.

## Что оказалось удачным
- Наличие **единого источника истины** (`HAND_MULTIPLIERS`) + тестов, которые напрямую фиксируют множители, делает баланс‑правки быстрыми и безопасными.

## Что улучшить в процессе
- Зафиксировать в процесс/доках (или в скриптах) быстрый “fallback” для гейтов, когда sandbox упирается в `EPERM` (чтобы не тратить время на повторные прогоны).

## Итог
Pair теперь платит **0.2x**, тесты/линт/сборка зелёные.


