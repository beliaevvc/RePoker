# Рефлексия: Mobile Landscape Fix & Guard

## Дата: 2025-12-23 (Landscape Fix)

### Что было запланировано
Изначально хотели "починить адаптив в landscape" на мобилках — сделать так, чтобы интерфейс масштабировался ("fit-to-viewport"), сохраняя десктопную раскладку, но умещаясь в маленький экран по высоте.

### Что было сделано (фактически)
1. **Попытка 1 (Scale):** Добавили логику `landscapeFitEnabled` с вычислением `transform: scale(...)` на основе `scrollHeight` или `innerHeight`.
   - **Результат:** Неудачно. Вызвало регрессии в portrait (белый экран из-за ошибок ссылок, мелкий масштаб из-за Safari viewport поведения). Также сложно контролировать `fixed` элементы при трансформации корня.
   - **Решение:** Полный откат изменений scale/layout.

2. **Попытка 2 (Guard/Заглушка):** Решили не ломать то, что работает (portrait), и просто заблокировать landscape на телефонах.
   - Реализовали оверлей-заглушку, который появляется только при `(orientation: landscape) + touch + small screen`.
   - Текст заглушки на английском: "LANDSCAPE DETECTED / PLEASE ROTATE DEVICE".

3. **Фикс Viewport:** Обнаружили, что при вращении телефона (Portrait -> Landscape -> Portrait) Safari сбрасывает масштаб или оставляет его мелким ("desktop view").
   - **Решение:** Добавили `maximum-scale=1.0, user-scalable=no` в `meta viewport`. Это стабилизировало поведение и размеры заглушки.

### Сложности и уроки
- **Mobile Safari Viewport:** Самая большая боль. Браузер пытается быть умным и "зумить" страницу, если контент не влазит, или оставлять зум при повороте. Жесткая фиксация `user-scalable=no` обязательна для app-like интерфейсов.
- **Риск "Умного" адаптива:** Попытка вписать сложный UI (с кучей `fixed`, `clamp`, `vh`) в нестандартный viewport (узкий по высоте) через `transform: scale` — это минное поле. Проще и надежнее запретить этот режим, если он не является критическим для геймплея.
- **ReferenceError при откате:** При удалении логики нужно быть предельно внимательным к JSX. Оставленные `ref={deletedRef}` приводят к белому экрану (крэш React).

### Итог
- Portrait работает стабильно (как и раньше).
- Landscape на телефонах корректно блокируется заглушкой.
- Зум/масштаб больше не скачет.

### Следующие шаги
- Если когда-то захотим **настоящий** landscape на мобилках — нужно делать **отдельный CSS-layout** (например, колоночный: слева карты, справа контролы), а не пытаться сжать десктопный. Но пока текущее решение (Portrait only) устраивает.

