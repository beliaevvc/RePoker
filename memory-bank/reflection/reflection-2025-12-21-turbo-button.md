# Рефлексия — Turbo-кнопка (ускорение темповых анимаций)

Дата: 2025-12-21  
Задача: Turbo-кнопка (Redima) — toggle ON/OFF, ускоряет “темповые” анимации/тайминги (раздача, выигрыши, каскад), **не** ускоряя декоративные эффекты (shake/ореолы/орбы/синематика).

## План vs факт

### Был план
- Добавить `turboEnabled` и масштабирование таймингов в `useBalatroInfernoController`
- Добавить кнопку `TURBO` в UI (toggle, disabled в `isBusy`, без `localStorage`)
- Ускорить только нужные CSS-анимации через CSS‑переменную
- Прогнать `test/lint/build`

### Что реализовано
- `useBalatroInfernoController`: добавлен `turboEnabled`, введён `timeFactor`/`scaleMs()` для каскадных `schedule()` таймеров, ускорены раздача (`dealing`) и задержка `suspense`.
- `BalatroInferno.jsx`: добавлена кнопка `TURBO` (toggle), запрещено переключение во время `isBusy`, класс `repoker-turbo` на корне при включённом Turbo.
- `balatroInferno.css`: добавлен `.repoker-turbo { --repoker-time-factor: 0.5; }`, анимации каскада (`vanish/appear/refill-flash`) и `cascade-mult-pop` переведены на `calc(... * var(--repoker-time-factor))`.
- `Card.jsx`: переходы появления (transitionDelay/Duration) привязаны к `--repoker-time-factor`, чтобы ускорялась “пересдача/въезд” карт без ускорения бесконечных декоративных анимаций.
- QA-гейты: `npm run test/lint/build` — зелёные.

## Что было сложным
- В среде sandbox `vitest` падал на `kill EPERM`, а `eslint` — на `EPERM` чтения файла из `node_modules`. Пришлось прогонять test/lint вне sandbox (с `all` permissions), чтобы получить реальный результат.

## Удачные решения
- Единый `timeFactor` для **JS-таймлайна** каскада: ускоряет ощущения скорости, не меняя порядок шагов.
- CSS‑переменная `--repoker-time-factor`: позволяет точечно ускорять только выбранные анимации, не затрагивая shake/orbs/ореолы.
- Запрет переключения Turbo во время `isBusy`: избегает рассинхронов и гонок таймеров.

## Что можно улучшить
- Вынести “скорость игры” в отдельный модуль/хук (например, `useGameSpeed`) и унифицировать все durations/тайминги в одном месте (с пресетами 1×/2× в будущем).
- Добавить мини-индикатор состояния (например, “Turbo ON”) рядом с MODE, чтобы было заметнее на мобилках.

## Критерии успеха (проверка)
- Turbo ON заметно ускоряет раздачу и каскадные шаги: ✅
- Декоративные shake/орбы/ореолы/синематика не ускоряются: ✅ (по реализации — не привязаны к переменной и не масштабируются)
- `npm run test`, `npm run lint`, `npm run build`: ✅


