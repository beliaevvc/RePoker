# Рефлексия — Ante ставки (2025-12-21)

## Контекст и цель
Нужно было **переделать ставки Ante**: заменить список значений на заданный и выставить **ставку по умолчанию = 1.00**.

## План vs факт
- **План**: найти источник Ante → обновить значения и дефолт → быстро проверить UI/расчёты на 0.20 и 100.
- **Факт**:
  - Нашли, что ставка была “свободной” (`bet + delta`, min/max), а дефолт стоял `10`.
  - Ввели единый источник правды для Ante (константы) и переписали изменение ставки на переключение по списку.
  - Подтянули дефолт 1.00 в контроллер состояния.
  - Привели отображение денег к **2 знакам после запятой** (важно для дробных Ante).
  - Обновили unit‑тесты и прогнали гейты (`test/lint/build`) — зелёные.

## Что сделали (технически)
- **Константы**: добавили `ANTE_VALUES` и `DEFAULT_ANTE`.
- **Логика изменения ставки**: `adjustBetUseCase` теперь двигается по списку (вперёд/назад), с учётом `balance`.
- **UI/UX**:
  - Кнопки `+/-` теперь “шаговые” по списку.
  - Денежные значения в HUD и баннере выигрыша форматируются как `0.20`, `1.00`, etc.

## Что было сложным / риски
- **Переход со старого поведения**: раньше ставка могла быть любой и “прыгать” на `±10`; теперь это дискретный список. Важно было:
  - корректно обработать случаи, когда текущая ставка **не ровно из списка** (старые сохранения/округления) — решили через поиск ближайшего значения.
  - учитывать ограничение по `balance`, чтобы ставка не уходила выше доступных средств.
- **Формат денег**: при дробных Ante без форматирования UI выглядел “грязно” (например `0.2` вместо `0.20`).

## Что сработало удачно
- **Единый источник правды** для Ante в application‑слое: проще менять дальше и меньше риска “разъезда” UI vs use-cases.
- **Обновление тестов** сразу после смены поведения: быстро поймали несовпадения ожиданий.

## Что улучшить в процессе (если будет продолжение)
- Если планируется сохранение Ante между сессиями — добавить отдельный `localStorage` ключ для ставки (с миграцией/валидатором по списку).
- Вынести форматирование денег в общий util (если появятся ещё экраны/виджеты с валютой).


