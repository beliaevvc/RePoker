# Архив — 2025-12-20 — Joker Pair Highest

## Summary
Исправлен баг в `getBestHand`: при наличии джокера и формировании **одной пары** джокер больше не образует пару с минимальным доступным рангом из-за порядка перебора — теперь выбирается **самая старшая** возможная пара. Добавлен unit‑тест и пройдены гейты.

## Requirements
- При 1–2 джокерах оценка должна выбирать **корректный лучший вариант** для одной и той же категории, а не “первый попавшийся” из перебора.
- Для кейса **Pair + Joker**: выбирать пару с **максимальным** рангом.

## Implementation
- **Корень проблемы**: при 1–2 джокерах используется перебор подстановок и выбор по максимуму `score`. Для `Pair` `score` был одинаковым → побеждала первая подстановка; так как `RANKS` перебираются по возрастанию, выбиралась младшая пара.
- **Решение**: сделан составной `score`: крупный “ведущий разряд” — категория (как раньше), “младшие разряды” — тай‑брейк (“сила внутри категории”) через кодирование рангов в base‑15. Это делает выбор детерминированным и корректным при брутфорсе.
- **Заметка на будущее**: может пригодиться явное хранение того, “какую карту представляет джокер” в лучшем результате (для UI/анимаций/подсветок).

## Testing
- Добавлен unit‑тест: “1 джокер + набор разных рангов ⇒ Pair с самой старшей картой”.
- Гейты пройдены: `npm run test`, `npm run lint`, `npm run build`.

## Lessons learned
- Для алгоритмов вида “перебор → выбрать максимум” важно иметь стабильный тай‑брейк, иначе порядок перебора превращается в скрытое правило.
- Лучше фиксировать такие кейсы отдельными unit‑тестами, чтобы защищаться от регрессов при дальнейших изменениях оценщика.

## References
- Reflection: `memory-bank/reflection/reflection-2025-12-20-joker-pair-highest.md`
- Код: `src/domain/hand-evaluator/getBestHand.ts`, `src/domain/hand-evaluator/getBestHand.test.ts`


