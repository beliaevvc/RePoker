# Creative Phase — Экран загрузки

## Контекст задачи

Создание экрана загрузки для RePoker с решением дилеммы: **красивый дизайн vs быстрая загрузка самого экрана загрузки**.

### Ограничения
- Экран загрузки не должен требовать внешних ресурсов (шрифты уже загружаются через `<link>` в `index.html`)
- Только встроенные CSS-анимации и простые эффекты (без изображений/тяжелых ресурсов)
- Должен определять готовность основных ресурсов (шрифты, CSS, текстуры из `public/textures/`)

---

## Решение 1: Визуальный стиль и элементы экрана загрузки

### Вариант A: Минималистичный с текстом и простой анимацией
**Описание:**
- Центрированный текст "RePoker" или "LOADING..." в стиле игры
- Простая анимация точек (три точки, которые мигают по очереди)
- Тёмный фон (#050510 или #1e293b) с минимальным CRT-оверлеем
- Без дополнительных элементов

**Плюсы:**
- ✅ Максимально быстрая загрузка (минимум CSS/элементов)
- ✅ Не требует никаких ресурсов кроме базового CSS
- ✅ Простота реализации

**Минусы:**
- ❌ Может показаться слишком простым/скучным
- ❌ Не соответствует "яркому" стилю игры

---

### Вариант B: Стилизованный с электрическими эффектами (РЕКОМЕНДУЕТСЯ)
**Описание:**
- Центрированный логотип/название "RePoker" в стиле игры (Press Start 2P, если уже загружен, иначе системный моноширинный)
- Электрический индикатор загрузки: несколько точек/орбов, которые "зажигаются" последовательно (стиль как в `ElectricPlasmaOrbs`)
- Тёмный фон (#050510) с лёгким CRT-оверлеем (опционально, но уже есть в CSS)
- Простая CSS-анимация pulse/spin для орбов (используем существующие анимации из `balatroInferno.css`)

**Плюсы:**
- ✅ Соответствует визуальному стилю игры (электрические орбы, пиксельный стиль)
- ✅ Использует уже существующие CSS-анимации (не добавляет новых ресурсов)
- ✅ Красивый и запоминающийся
- ✅ Быстрая загрузка (только CSS, без изображений)

**Минусы:**
- ⚠️ Немного сложнее в реализации (но всё ещё только CSS)
- ⚠️ Зависит от загрузки шрифта Press Start 2P (но он уже загружается через `<link>`)

---

### Вариант C: С анимированными картами
**Описание:**
- Показываем стилизованные карты (без изображений, только CSS-блоки с границами)
- Карты "переворачиваются" или "появляются" по очереди
- Текст "LOADING..." под картами

**Плюсы:**
- ✅ Тематически соответствует игре
- ✅ Визуально интересно

**Минусы:**
- ❌ Сложнее в реализации (нужно создавать карты через CSS)
- ❌ Может быть тяжелее для рендеринга (больше элементов)
- ❌ Риск FOUT/FOIT если шрифт не загружен

---

### **Выбранный вариант: C (С анимированными картами Royal Flush) — ОБНОВЛЕНО**

**Обоснование:**
- Тематически соответствует игре (показываем лучшую комбинацию)
- Карты один в один в стиле игры (используем компонент `Card.jsx`)
- Визуально эффектно и запоминается
- Полноценный прогресс-бар для лучшего UX

**Детали реализации:**
- **Карты**: 5 карт Royal Flush (10, J, Q, K, A одной масти, например hearts) используя компонент `Card.jsx`
- **Текст**: "RePoker" или "LOADING..." в стиле Press Start 2P (fallback на системный monospace)
- **Прогресс-бар**: полноценный прогресс-бар с процентами, заполняющийся по мере готовности ресурсов
- **Фон**: тёмный (#050510) с CRT-оверлеем (класс `.crt-overlay`)
- **Анимации**: карты могут иметь лёгкую анимацию появления/пульсации

---

## Решение 2: Стратегия проверки готовности ресурсов

### Вариант A: Проверка всех ресурсов последовательно
**Описание:**
- Проверяем шрифты → текстуры → CSS последовательно
- Ждём полной готовности каждого ресурса перед переходом к следующему

**Плюсы:**
- ✅ Простая логика
- ✅ Гарантирует готовность всех ресурсов

**Минусы:**
- ❌ Медленнее (последовательная проверка)
- ❌ Может задержать показ игры даже если часть ресурсов уже готова

---

### Вариант B: Параллельная проверка с таймаутом (РЕКОМЕНДУЕТСЯ)
**Описание:**
- Запускаем проверку всех ресурсов параллельно (`Promise.all`)
- Устанавливаем разумный таймаут (например, 3-5 секунд) на случай зависания
- Если ресурсы готовы быстро → показываем игру сразу
- Если таймаут → показываем игру всё равно (лучше показать игру с FOUT, чем бесконечный loading)

**Плюсы:**
- ✅ Быстрее (параллельная проверка)
- ✅ Защита от зависания (таймаут)
- ✅ UX: не блокируем игру надолго

**Минусы:**
- ⚠️ Немного сложнее в реализации (нужно обрабатывать таймауты)

---

### Вариант C: Проверка только критических ресурсов
**Описание:**
- Проверяем только шрифты (самое критичное для UI)
- Текстуры и CSS считаем "nice to have" (игра может работать и без них)

**Плюсы:**
- ✅ Максимально быстрая проверка
- ✅ Минимум логики

**Минусы:**
- ❌ Риск показать игру до готовности текстур (может быть визуальный глитч)
- ❌ Не соответствует требованию "полная готовность ресурсов"

---

### **Выбранный вариант: B (Параллельная проверка с таймаутом)**

**Обоснование:**
- Баланс между надёжностью и скоростью
- Защита от зависания (важно для UX)
- Параллельная проверка быстрее последовательной

**Детали реализации:**
- `resourceLoader.checkResourcesReady()` возвращает `Promise<boolean>`
- Внутри: `Promise.all([checkFonts(), checkTextures(), checkCSS()])` с таймаутом 5 секунд
- Если таймаут → возвращаем `true` (лучше показать игру, чем бесконечный loading)

---

## Решение 3: Индикатор прогресса

### Вариант A: Без индикатора прогресса
**Описание:**
- Просто показываем анимацию загрузки без конкретного прогресса
- Пользователь видит, что что-то происходит, но не знает сколько осталось

**Плюсы:**
- ✅ Простота реализации
- ✅ Меньше кода

**Минусы:**
- ❌ Плохой UX (пользователь не знает сколько ждать)
- ❌ Может показаться, что игра зависла

---

### Вариант B: Простой индикатор (зажигающиеся орбы) (РЕКОМЕНДУЕТСЯ)
**Описание:**
- Показываем 3-5 электрических орбов
- Орбы зажигаются последовательно по мере готовности ресурсов (шрифты → текстуры → CSS)
- Визуально показывает прогресс без точных процентов

**Плюсы:**
- ✅ Хороший UX (пользователь видит прогресс)
- ✅ Соответствует стилю игры (электрические орбы)
- ✅ Не требует сложной логики (просто считаем готовные ресурсы)

**Минусы:**
- ⚠️ Нужно отслеживать прогресс проверки ресурсов

---

### Вариант C: Точный процент загрузки
**Описание:**
- Показываем процент загрузки (0%, 33%, 66%, 100%)
- Текст "Loading... 66%"

**Плюсы:**
- ✅ Максимально информативный UX

**Минусы:**
- ❌ Сложнее в реализации (нужно точно отслеживать прогресс каждого ресурса)
- ❌ Может быть неточным (шрифты могут загружаться нелинейно)
- ❌ Не соответствует стилю игры (слишком "технично")

---

### **Выбранный вариант: C (Полноценный прогресс-бар) — ОБНОВЛЕНО**

**Обоснование:**
- Максимально информативный UX (пользователь видит точный прогресс)
- Профессиональный вид
- Легко реализуется через CSS

**Детали реализации:**
- Горизонтальный прогресс-бар с процентами (0% → 100%)
- Заполняется по мере готовности ресурсов (шрифты 33%, текстуры 33%, CSS 34%)
- Стиль: соответствует пиксельному стилю игры (границы, тени)
- Текст процентов отображается над/внутри прогресс-бара

---

## Итоговые решения (ОБНОВЛЕНО)

### Визуальный стиль
✅ **Вариант C**: Экран с картами Royal Flush
- 5 карт Royal Flush (10, J, Q, K, A одной масти) используя компонент `Card.jsx`
- Текст "RePoker" в стиле Press Start 2P
- Полноценный прогресс-бар с процентами
- Тёмный фон с CRT-оверлеем
- Использование существующих CSS-анимаций

### Стратегия проверки ресурсов
✅ **Вариант B**: Параллельная проверка с таймаутом 5 секунд
- `Promise.all` для параллельной проверки шрифтов, текстур, CSS
- Таймаут 5 секунд на случай зависания
- Если таймаут → показываем игру всё равно
- **Отслеживание прогресса**: обновляем прогресс по мере готовности каждого ресурса (для прогресс-бара)

### Индикатор прогресса
✅ **Вариант C**: Полноценный прогресс-бар с процентами
- Горизонтальный прогресс-бар заполняющийся от 0% до 100%
- Процент отображается над/внутри прогресс-бара
- Заполнение: шрифты 33%, текстуры 33%, CSS 34%

---

## Технические детали

### Структура компонента LoadingScreen
```jsx
<LoadingScreen progress={progressPercent} />
// progressPercent: number (0-100)
// Внутри компонента: 5 карт Royal Flush + прогресс-бар
```

### Структура resourceLoader
```typescript
export const resourceLoader = {
  checkResourcesReady(): Promise<boolean> {
    // Promise.all с таймаутом
  },
  checkFonts(): Promise<boolean>,
  checkTextures(): Promise<boolean>,
  checkCSS(): Promise<boolean>
}
```

### Интеграция в App.jsx
```jsx
const [isReady, setIsReady] = useState(false)
const [progress, setProgress] = useState({ fonts: false, textures: false, css: false })

useEffect(() => {
  resourceLoader.checkResourcesReady().then(setIsReady)
  // Обновляем progress по мере готовности ресурсов
}, [])

return isReady ? <BalatroInferno /> : <LoadingScreen progress={progress} />
```

---

## Риски и митигация

1. **Риск**: Шрифт Press Start 2P не успевает загрузиться до показа экрана загрузки
   - **Митигация**: Используем fallback на системный моноширинный шрифт (monospace)

2. **Риск**: Текстуры загружаются очень долго
   - **Митигация**: Таймаут 5 секунд, после которого показываем игру даже если текстуры не готовы

3. **Риск**: Экран загрузки сам требует много ресурсов
   - **Митигация**: Используем только CSS-анимации, без изображений, минимум элементов DOM

