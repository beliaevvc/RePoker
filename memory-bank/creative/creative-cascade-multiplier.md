# Creative — Cascade Multiplier (x1→x2→x3→x5)

## Контекст / цель
- В режиме **CASCADE** каждый выигрышный шаг увеличивает выплаты за комбинацию на множитель каскада:
  - win-step 1: **1×**
  - win-step 2: **2×**
  - win-step 3: **3×**
  - win-step 4+: **5×**
- Множитель применяется **только к выплате за комбинацию** (hand payout), **не** применяется к **jackpot**.
- Если **нет выигрыша** — каскад заканчивается, **множителя нет**.
- В **NORMAL** streak остаётся как есть. В **CASCADE** streak **не используется** и не должен меняться.

---

## Точка выбора 1 — Где считать множитель (архитектура)
### Вариант A: считать в UI-контроллере (`useBalatroInfernoController.js`)
- **Плюсы**
  - Быстро внедрить (уже есть `cascadeStepIndex` и `winBannerAmount`).
  - Минимум изменений в application/use-cases.
- **Минусы**
  - Бизнес-логика денег утекает в UI.
  - Тестировать сложнее (нужно через UI-оркестрацию).

### Вариант B: считать в application (`applyCascadeStepUseCase`)
- Подход: добавить в input `winStepNumber`, внутри use-case применять `getCascadeMultiplierForWinStep`.
- **Плюсы**
  - Логика выплат остаётся в application (правильно по слоям).
  - Легко покрыть unit-тестами (маппинг шага и итоговый `winAmount`).
  - UI остаётся “тонким”: передаёт номер win-шага и отображает готовые числа.
- **Минусы**
  - Небольшое изменение сигнатуры use-case и всех вызовов.

### Вариант C: отдельный use-case “applyCascadePayoutMultiplier”
- **Плюсы**
  - Максимальная изоляция механики выплат.
- **Минусы**
  - Лишняя прослойка ради простой формулы (сложнее поддерживать).

**Решение:** выбрать **Вариант B**.  
**Почему:** множитель — это игровое правило и часть расчёта выплат; UI должен только показывать и анимировать.

---

## Точка выбора 2 — Как показывать множитель (UI/UX)
### Вариант A: маленький бейдж у переключателя MODE (верхняя панель)
- **Плюсы:** всегда заметен; не конфликтует с картами.
- **Минусы:** в каскаде взгляд чаще в центре (карты + баннер выигрыша).

### Вариант B: заменить `ElectricPlasmaOrbs` под картами на индикатор множителя (в CASCADE)
- **Плюсы**
  - “Замена streak” становится буквальной: в normal — орбы streak, в cascade — индикатор мультипликатора.
  - Место уже выделено и визуально привязано к “прогрессу серии/каскада”.
  - Легко сделать заметным (не перекрывает карты/баннер).
- **Минусы:** нужно аккуратно подобрать высоту/контраст, чтобы не перегрузить низ экрана.

### Вариант C: встраивать множитель в win-баннер (добавить строку “MULT xN”)
- **Плюсы:** виден ровно в момент начисления.
- **Минусы:** не даёт “постоянного” ощущения прогресса каскада между шагами.

**Решение:** базовый вариант — **B** + небольшая подпись в win-баннере (лёгкая версия C).  

#### Спецификация UI-индикатора (вариант B)
- Компонент: `CascadeMultiplierIndicator`
- Отображение:
  - Только если `mode === 'cascade'`.
  - Во время каскада (`gameState === 'cascading'`) и только после первого win-шага (когда известен `winStepNumber`).
  - Показывает **4 уровня**: `1× / 2× / 3× / 5×` (последний — “cap”).
  - Активный уровень подсвечен, предыдущие могут оставаться “зажжёнными” (как прогресс-бар).
- Анимации:
  - При смене уровня — короткий “pop” (scale + glow) и лёгкая “electric” обводка (в стиле орбов).
  - Уровень 5× — более агрессивный glow/цвет (например, gold/red).

#### Интеграция в win-баннер (лёгкий вариант C)
- В режиме каскада, если показываем step win banner, добавляем маленькую строку:
  - `CASCADE MULT xN` (где N = 1/2/3/5)

---

## Точка выбора 3 — Цвета/темы уровней
### Вариант A: одинаковый цвет, меняется только текст xN
- **Плюсы:** минимализм.
- **Минусы:** меньше “вау” и слабее ощущение роста.

### Вариант B: градиент по уровню (1× blue → 2× purple → 3× magenta → 5× gold/red)
- **Плюсы:** заметно и “игрово”, хорошо считывается.
- **Минусы:** нужно аккуратно подобрать контраст на фоне.

**Решение:** **B** (градиент/смена цвета по уровню), в стилистике текущих эффектов.

---

## Итог (что пойдёт в /build)
- Механика: `getCascadeMultiplierForWinStep(winStepNumber)` + применение в `applyCascadeStepUseCase` (множим только hand payout).
- UI: в CASCADE вместо `ElectricPlasmaOrbs` показываем `CascadeMultiplierIndicator`, плюс строка в win-баннере `CASCADE MULT xN`.


